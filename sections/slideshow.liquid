{%- capture section_settings -%}
    {
    "autoPlay": {{ section.settings.autoplay | json }},
    "prevNextButtons": true,
    "pageDots": true,
    "setGallerySize": true,
    "adaptiveHeight": true,
    "transitionEffect": {{ section.settings.carousel_effect | json }},
    "cycleSpeed": {{ section.settings.cycle_speed | times: 1000 | json }}
    }
{%- endcapture -%}

<section data-section-id="{{ section.id }}" data-section-type="slideshow" data-section-settings='{{ section_settings }}' style="position: relative; overflow: hidden;">
    <div {% unless section.settings.edge_to_edge %}class="container container--flush"{% endunless %} style="position: relative; z-index: 1;">
        <div class="slideshow slideshow--{{ section.settings.section_size | replace: '_', '-' }} {% if section.settings.edge_to_edge %}slideshow--edge2edge{% endif %}"
             style="color: #ffffff">
            {%- for i in (1..5) -%}
                {%- assign block_id = "custom-slide-" | append: i -%}
                {%- assign desktop_image_name = "desktop0" | append: i | append: ".png" -%}
                {%- assign mobile_image_name = "mobile0" | append: i | append: ".png" -%}
                {%- assign desktop_image_url = desktop_image_name | asset_url -%}
                {%- assign mobile_image_url = mobile_image_name | asset_url -%}

                {%- capture slide_inner -%}
                    <div class="slideshow__slide-inner slideshow__slide-inner--middle-center lazyload image--fade-in">
                        
                        {%- comment -%} Desktop Image {%- endcomment -%}
                        <div class="aspect-ratio hidden-phone" style="padding-bottom: 300px; height: 300px;">
                            <img class="slideshow__image lazyload image--fade-in"
                                 alt="{{ desktop_image_name }}"
                                 data-src="{{ desktop_image_url }}"
                                 src="{{ desktop_image_url }}"
                                 style="width: 100%; height: 100%; object-fit: cover;">
                        </div>

                        {%- comment -%} Mobile Image {%- endcomment -%}
                        <div class="aspect-ratio hidden-tablet-and-up">
                            <img class="slideshow__image lazyload image--fade-in"
                                 alt="{{ mobile_image_name }}"
                                 data-src="{{ mobile_image_url }}"
                                 src="{{ mobile_image_url }}"
                                 style="width: 100%; height: auto;">
                        </div>

                    </div>

                    <style>
                        #block-{{ block_id }} .slideshow__image,
                        #block-{{ block_id }} .slideshow__slide-inner {
                            border-radius: 20px;
                        }
                        @media screen and (max-width: 768px) {
                            #block-{{ block_id }} .slideshow__image {
                                border-radius: 0 !important;
                            }
                        }
                    </style>
                {%- endcapture -%}

                <div class="slideshow__slide" id="block-{{ block_id }}" data-block-index="{{ forloop.index0 }}">
                    {{- slide_inner -}}
                </div>
            {%- endfor -%}
        </div>
    </div>
</section>

{% if section.settings.slideduvidas %}
    <style>
        #shopify-section-{{ section.id }} .flickity-page-dots {
            display: none;
        }

        @media (min-width: 768px) {
          #shopify-section-{{ section.id }} {
             margin-bottom: -41px;
          }
        }
    </style>
{% endif %}

<style>
@media screen and (max-width: 768px) {
    section[data-section-id="{{ section.id }}"] {
        background: transparent !important;
    }

    /* Prevent banner cropping on mobile */
    section[data-section-id="{{ section.id }}"] .slideshow__slide,
    section[data-section-id="{{ section.id }}"] .slideshow__slide-inner,
    section[data-section-id="{{ section.id }}"] .aspect-ratio {
        height: auto !important;
        min-height: auto !important;
        padding-bottom: 0 !important;
        border-radius: 0 !important;
        background: transparent !important;
    }

    /* Force viewport to be slightly taller to prevent sub-pixel clipping */
    section[data-section-id="{{ section.id }}"] .slideshow__slide {
        padding-bottom: 2px !important;
    }

    section[data-section-id="{{ section.id }}"] .slideshow__image {
        position: relative !important;
        height: auto !important;
        width: 100% !important;
        object-fit: contain !important;
        border-radius: 20px !important;
        display: block !important;
    }
}

@media screen and (min-width: 1000px) {
    section[data-section-id="{{ section.id }}"] {
        margin-top: -10px !important; /* Negative margin to pull banner up */
    }

    /* Enforce 1576px width and 300px height for HeroBanner */
    section[data-section-id="{{ section.id }}"] .container {
        max-width: 1576px !important;
        padding-left: 0;
        padding-right: 0;
        margin-left: auto;
        margin-right: auto;
    }

    section[data-section-id="{{ section.id }}"] .slideshow,
    section[data-section-id="{{ section.id }}"] .slideshow__slide,
    section[data-section-id="{{ section.id }}"] .slideshow__slide-inner,
    section[data-section-id="{{ section.id }}"] .aspect-ratio {
        height: 300px !important;
        min-height: 300px !important;
        max-height: 300px !important;
        padding-bottom: 0 !important; /* Override aspect-ratio hack */
    }

    section[data-section-id="{{ section.id }}"] .slideshow__image {
        height: 300px !important;
        width: 100% !important;
        object-fit: cover !important;
    }
}
</style>

{% schema %}
{
  "name": "Slideshow",
  "max_blocks": 6,
  "settings": [
    {
      "type": "checkbox",
      "id": "edge_to_edge",
      "label": "Full-width",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "redondo",
      "label": "Slider arredondado",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "active_zoom",
      "label": "Slider com zoom",
      "default": true
    },
    {
      "type": "select",
      "id": "section_size",
      "label": "Image size",
      "options": [
        {
          "value": "preserve_ratio",
          "label": "Original image ratio"
        },
        {
          "value": "small",
          "label": "Small"
        },
        {
          "value": "medium",
          "label": "Medium"
        },
        {
          "value": "large",
          "label": "Large"
        }
      ],
      "default": "preserve_ratio"
    },
    {
      "type": "select",
      "id": "carousel_effect",
      "label": "Transition effect",
      "options": [
        {
          "value": "fade",
          "label": "Fade"
        },
        {
          "value": "slide",
          "label": "Slide"
        }
      ],
      "default": "slide"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Auto rotate between slides",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "slideduvidas",
      "label": "Slide de d√∫vidas",
      "default": false
    },
    {
      "type": "range",
      "id": "cycle_speed",
      "min": 3,
      "max": 8,
      "step": 1,
      "unit": "sec",
      "label": "Change slides every",
      "default": 5
    }
  ],
  "blocks": [
    {
      "type": "image",
      "name": "Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image",
          "info": "1800 x 600px .jpg recommended"
        },
        {
          "type": "image_picker",
          "id": "mobile_image",
          "label": "Mobile image",
          "info": "750 x 1100px .jpg recommended. If none is set, desktop image will be used."
        },
        {
          "type": "checkbox",
          "id": "show_overlay",
          "label": "Show overlay",
          "info": "Increase text readability on busy images.",
          "default": false
        },
        {
          "type": "range",
          "id": "overlay_opacity",
          "label": "Overlay opacity",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "default": 30
        },
        {
          "type": "color",
          "id": "text_color",
          "label": "Text",
          "default": "#ffffff"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Heading",
          "default": "Slide title"
        },
        {
          "type": "textarea",
          "id": "content",
          "label": "Content",
          "default": "Tell your story"
        },
        {
          "type": "select",
          "id": "content_position",
          "label": "Content position",
          "info": "On mobile, content is always centered.",
          "options": [
            {
              "value": "top_left",
              "label": "Top left"
            },
            {
              "value": "top_center",
              "label": "Top center"
            },
            {
              "value": "top_right",
              "label": "Top right"
            },
            {
              "value": "middle_left",
              "label": "Middle left"
            },
            {
              "value": "middle_center",
              "label": "Middle center"
            },
            {
              "value": "middle_right",
              "label": "Middle right"
            },
            {
              "value": "bottom_left",
              "label": "Bottom left"
            },
            {
              "value": "bottom_center",
              "label": "Bottom center"
            },
            {
              "value": "bottom_right",
              "label": "Bottom right"
            }
          ],
          "default": "middle_center"
        },
        {
          "type": "header",
          "content": "Button"
        },
        {
          "type": "color",
          "id": "button_background",
          "label": "Background",
          "default": "#ffffff"
        },
        {
          "type": "color",
          "id": "button_text_color",
          "label": "Text",
          "default": "#000000"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Text",
          "default": "Button"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link",
          "info": "If no text is set for button, the whole image becomes clickable."
        }
      ]
    }
  ],
  "presets": [
    {
      "category": "Image",
      "name": "Slideshow",
      "blocks": [
        {
          "type": "image"
        },
        {
          "type": "image"
        }
      ]
    }
  ]
}
{% endschema %}
